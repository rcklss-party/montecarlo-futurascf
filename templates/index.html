<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Futura SCF | Monte Carlo Simulator</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar Controls -->
        <aside class="sidebar">
            <!-- Brand removed for embed mode -->

            <div class="controls-panel">
                <form id="simulationForm">

                    <!-- ===== BOX 1: ASSET ALLOCATION ===== -->
                    <div class="mode-box" id="allocation-box" data-mode="allocation">
                        <div class="mode-header">
                            <input type="radio" name="simulationMode" id="mode-allocation" value="allocation">
                            <label for="mode-allocation">
                                <i class="fa-solid fa-pie-chart"></i> Asset Allocation
                            </label>
                        </div>
                        <div class="mode-content">
                            <!-- SCROLLABLE CONTENT AREA -->
                            <div class="allocation-scroll-content">
                                <!-- PRESET BUTTONS -->
                                <div class="preset-row">
                                    <button type="button" class="preset-btn" data-preset="conservative">
                                        <i class="fa-solid fa-shield-halved"></i> Conservativo
                                    </button>
                                    <button type="button" class="preset-btn" data-preset="balanced">
                                        <i class="fa-solid fa-scale-balanced"></i> Bilanciato
                                    </button>
                                    <button type="button" class="preset-btn" data-preset="aggressive">
                                        <i class="fa-solid fa-rocket"></i> Aggressivo
                                    </button>
                                </div>

                                <!-- LAZY PORTFOLIOS DROPDOWN -->
                                <div class="input-group compact-group"
                                    style="margin-bottom: 0.8rem; padding: 0 2px; display: block !important; opacity: 1 !important; background: #fff;">
                                    <div class="input-wrapper">
                                        <i class="fa-solid fa-book-open input-icon"
                                            style="font-size: 0.8rem; top: 50%; transform: translateY(-50%);"></i>
                                        <select id="lazy-portfolios" class="lazy-select">
                                            <option value="" disabled selected>Lazy Portfolios...</option>
                                            <option value="golden_butterfly">ü¶ã Golden Butterfly</option>
                                            <option value="permanent">üèõÔ∏è Permanent Portfolio</option>
                                            <option value="all_weather">üåßÔ∏è All-Weather (Ray Dalio)</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- ACCORDION ASSET CATEGORIES -->
                                <div class="asset-accordion">
                                    <!-- CORE MARKETS -->
                                    <div class="accordion-section open" data-section="core">
                                        <div class="accordion-header">
                                            <i class="fa-solid fa-globe"></i> Core Markets
                                            <span class="section-total" id="total-core">0%</span>
                                            <i class="fa-solid fa-chevron-down accordion-icon"></i>
                                        </div>
                                        <div class="accordion-body">
                                            <div class="asset-control">
                                                <label>S&P 500 (USA) <span id="weight-sp500-val">40%</span></label>
                                                <input type="range" id="weight-sp500" min="0" max="100" value="40"
                                                    step="5" class="asset-slider" data-category="core">
                                            </div>
                                            <div class="asset-control">
                                                <label>World ex-USA <span id="weight-exusa-val">20%</span></label>
                                                <input type="range" id="weight-exusa" min="0" max="100" value="20"
                                                    step="5" class="asset-slider" data-category="core">
                                            </div>
                                            <div class="asset-control">
                                                <label>Emerging Markets <span id="weight-em-val">5%</span></label>
                                                <input type="range" id="weight-em" min="0" max="100" value="5" step="5"
                                                    class="asset-slider" data-category="core">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- SMART BETA / FACTORS -->
                                    <div class="accordion-section" data-section="factors">
                                        <div class="accordion-header">
                                            <i class="fa-solid fa-chart-line"></i> Smart Beta
                                            <span class="section-total" id="total-factors">0%</span>
                                            <i class="fa-solid fa-chevron-down accordion-icon"></i>
                                        </div>
                                        <div class="accordion-body">
                                            <div class="asset-control">
                                                <label>Quality <span id="weight-quality-val">0%</span></label>
                                                <input type="range" id="weight-quality" min="0" max="100" value="0"
                                                    step="5" class="asset-slider" data-category="factors">
                                            </div>
                                            <div class="asset-control">
                                                <label>Value <span id="weight-value-val">0%</span></label>
                                                <input type="range" id="weight-value" min="0" max="100" value="0"
                                                    step="5" class="asset-slider" data-category="factors">
                                            </div>
                                            <div class="asset-control">
                                                <label>Momentum <span id="weight-momentum-val">0%</span></label>
                                                <input type="range" id="weight-momentum" min="0" max="100" value="0"
                                                    step="5" class="asset-slider" data-category="factors">
                                            </div>
                                            <div class="asset-control">
                                                <label>Small Cap <span id="weight-smallcap-val">0%</span></label>
                                                <input type="range" id="weight-smallcap" min="0" max="100" value="0"
                                                    step="5" class="asset-slider" data-category="factors">
                                            </div>
                                            <div class="asset-control">
                                                <label>Multifactor <span id="weight-multifactor-val">0%</span></label>
                                                <input type="range" id="weight-multifactor" min="0" max="100" value="0"
                                                    step="5" class="asset-slider" data-category="factors">
                                            </div>
                                        </div>
                                    </div>

                                    <!-- BONDS & ALTERNATIVES -->
                                    <div class="accordion-section" data-section="bonds">
                                        <div class="accordion-header">
                                            <i class="fa-solid fa-landmark"></i> Bonds & Alt
                                            <span class="section-total" id="total-bonds">0%</span>
                                            <i class="fa-solid fa-chevron-down accordion-icon"></i>
                                        </div>
                                        <div class="accordion-body">
                                            <div class="asset-control">
                                                <label>Obblig. Euro <span id="weight-euro-val">15%</span></label>
                                                <input type="range" id="weight-euro" min="0" max="100" value="15"
                                                    step="5" class="asset-slider" data-category="bonds">
                                            </div>
                                            <div class="asset-control">
                                                <label>Obblig. Global <span id="weight-glob-val">10%</span></label>
                                                <input type="range" id="weight-glob" min="0" max="100" value="10"
                                                    step="5" class="asset-slider" data-category="bonds">
                                            </div>
                                            <div class="asset-control">
                                                <label>Oro <span id="weight-gold-val">10%</span></label>
                                                <input type="range" id="weight-gold" min="0" max="100" value="10"
                                                    step="5" class="asset-slider" data-category="bonds">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div> <!-- End Scrollable -->

                            <!-- FIXED FOOTER -->
                            <!-- Removed fixed footer from here (moved to header) -->


                            <hr class="mode-divider">

                            <!-- Sim params duplicated for Allocation Mode -->
                            <div class="input-group">
                                <label for="capital-alloc">Capitale Iniziale (‚Ç¨)</label>
                                <div class="input-wrapper">
                                    <i class="fa-solid fa-euro-sign input-icon"></i>
                                    <input type="number" id="capital-alloc" class="sync-capital" value="400000"
                                        step="1000">
                                </div>
                            </div>

                            <div class="input-group">
                                <label for="years-alloc">Orizzonte (Anni)</label>
                                <div class="input-wrapper">
                                    <i class="fa-regular fa-calendar input-icon"></i>
                                    <input type="number" id="years-alloc" class="sync-years" value="30" step="1"
                                        max="50" min="1">
                                </div>
                                <!-- Range slider duplicated for nice UX or removed? Let's add it for consistency if space allows -->
                                <input type="range" id="yearsRange-alloc" min="1" max="50" value="30"
                                    class="range-slider">
                            </div>

                            <div class="input-group">
                                <label for="n_sims-alloc">Numero Simulazioni</label>
                                <div class="input-wrapper">
                                    <i class="fa-solid fa-layer-group input-icon"></i>
                                    <select id="n_sims-alloc" class="sync-sims">
                                        <option value="1000">1.000 (Veloce)</option>
                                        <option value="5000">5.000 (Bilanciato)</option>
                                        <option value="10000" selected>10.000 (Preciso)</option>
                                    </select>
                                </div>
                            </div>

                            <!-- SUBMIT BUTTON (inside mode) -->
                            <button type="submit" class="btn-primary mode-submit" id="submit-btn-alloc">
                                <span class="btn-text">Esegui Simulazione</span>
                                <span class="loader" style="display:none;"></span>
                            </button>
                        </div>
                    </div>

                    <!-- ===== BOX 2: PARAMETRI MANUALI ===== -->
                    <div class="mode-box" id="params-box" data-mode="params">
                        <div class="mode-header">
                            <input type="radio" name="simulationMode" id="mode-params" value="params">
                            <label for="mode-params">
                                <i class="fa-solid fa-sliders"></i> Parametri Manuali
                            </label>
                        </div>
                        <div class="mode-content">
                            <!-- Specific params -->
                            <div class="input-group">
                                <label for="mu">Rendimento Atteso Annuo (%)</label>
                                <div class="input-wrapper">
                                    <i class="fa-solid fa-arrow-trend-up input-icon"></i>
                                    <input type="number" id="mu" name="mu" value="5.23" step="0.01">
                                </div>
                            </div>

                            <div class="input-group">
                                <label for="sigma">Volatilit√† Annua (%)</label>
                                <div class="input-wrapper">
                                    <i class="fa-solid fa-bolt input-icon"></i>
                                    <input type="number" id="sigma" name="sigma" value="6.95" step="0.01">
                                </div>
                            </div>

                            <hr class="mode-divider">

                            <!-- Sim params duplicated for Manual Mode -->
                            <div class="input-group">
                                <label for="capital-manual">Capitale Iniziale (‚Ç¨)</label>
                                <div class="input-wrapper">
                                    <i class="fa-solid fa-euro-sign input-icon"></i>
                                    <input type="number" id="capital-manual" class="sync-capital" value="400000"
                                        step="1000">
                                </div>
                            </div>

                            <div class="input-group">
                                <label for="years-manual">Orizzonte (Anni)</label>
                                <div class="input-wrapper">
                                    <i class="fa-regular fa-calendar input-icon"></i>
                                    <input type="number" id="years-manual" class="sync-years" value="30" step="1"
                                        max="50" min="1">
                                </div>
                                <!-- Range optional here, or just simple input to save space -->
                            </div>

                            <div class="input-group">
                                <label for="n_sims-manual">Numero Simulazioni</label>
                                <div class="input-wrapper">
                                    <i class="fa-solid fa-layer-group input-icon"></i>
                                    <select id="n_sims-manual" class="sync-sims">
                                        <option value="1000">1.000 (Veloce)</option>
                                        <option value="5000">5.000 (Bilanciato)</option>
                                        <option value="10000" selected>10.000 (Preciso)</option>
                                    </select>
                                </div>
                            </div>

                            <!-- SUBMIT BUTTON (inside mode) -->
                            <button type="submit" class="btn-primary mode-submit" id="submit-btn-params">
                                <span class="btn-text">Esegui Simulazione</span>
                                <span class="loader" style="display:none;"></span>
                            </button>
                        </div>
                    </div>

                    <!-- Validation Message -->
                    <div id="validation-message" class="validation-message"></div>

                    <!-- Submit moved to footer -->
                </form>
            </div>

            <div class="sidebar-footer">
                <!-- GLOBAL STATS (Moved to footer) -->
                <div class="global-stats-box" style="margin-bottom: 1rem; text-align: left;">
                    <div class="allocation-status compact">
                        <div class="allocation-bar">
                            <div class="allocation-fill" id="allocation-fill"></div>
                        </div>
                        <div class="allocation-text">
                            Totale: <span id="total-allocation">100</span>%
                            <span id="allocation-status-icon"></span>
                        </div>
                    </div>
                    <div class="calculated-stats compact">
                        <div class="stat-item">Rend: <strong id="calc-mu">0.00%</strong></div>
                        <div class="stat-item">Vol: <strong id="calc-sigma">0.00%</strong></div>
                    </div>
                </div>

                <!-- Button removed from footer (now inside each mode box) -->

                <p>&copy; 2026 Futura SCF</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="top-bar">
                <div class="simulation-status">
                    <span class="status-dot"></span>
                    <span id="statusText">Seleziona una modalit√† per iniziare</span>
                </div>
            </header>

            <div class="dashboard-grid">
                <!-- Chart Section -->
                <div class="card chart-card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-chart-area"></i> Proiezione Probabilistica</h3>
                        <div class="card-actions">
                            <button class="icon-btn" onclick="downloadChart()" id="download-btn" disabled><i
                                    class="fa-solid fa-download"></i></button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="plotlyChart">
                            <!-- Empty State Placeholder -->
                            <div class="empty-state" id="empty-state">
                                <i class="fa-solid fa-chart-line"></i>
                                <h4>Nessuna Simulazione</h4>
                                <p>Seleziona una modalit√†, configura i parametri e clicca "Esegui Simulazione"</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Distribution Visualization Section -->
                <div class="card dist-card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-chart-area"></i> Distribuzione Probabilit√†</h3>
                    </div>
                    <div class="card-body" style="padding: 0;">
                        <div id="distributionChart" style="width: 100%; height: 250px;"></div>
                    </div>
                </div>

                <!-- Stats Section -->
                <div class="card stats-card">
                    <div class="card-header">
                        <h3><i class="fa-solid fa-table-list"></i> Scenari Finali</h3>
                        <!-- Optional View Toggle -->
                        <div class="card-actions">
                            <span class="nudge-hint">Ordina per probabilit√† ‚Üí</span>
                            <button class="icon-btn" id="view-toggle-btn" title="Vista Focus Probabilit√†">
                                <i class="fa-solid fa-layer-group"></i>
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="table-container">
                            <table id="resultsTable">
                                <thead>
                                    <tr>
                                        <th>Scenario</th>
                                        <th>Percentile</th>
                                        <th>Valore Finale</th>
                                        <th>Rendimento Tot.</th>
                                        <th>CAGR</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="empty-row" id="empty-table-row">
                                        <td colspan="5"
                                            style="text-align: center; color: var(--text-muted); padding: 2rem;">
                                            I risultati appariranno qui dopo la simulazione
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>